import{g as A,c as Z,u as W,M as ee,a0 as se,r as o,j as t,I as b,B as N,m,X as u}from"./index-CclgMCKg.js";import{u as te,F as y}from"./index-Y7Vl51Ml.js";import{h as ae}from"./index.esm-DXPRXp1r.js";import{s as re}from"./strfAtom-DiXSu571.js";import{m as oe,c as le}from"./match-BrbVKEl2.js";import{S as ce}from"./index-DzJzb7gE.js";import{U as ie}from"./index-BfZ_5wYh.js";import"./motion-BtiDeT7c.js";import"./collapse-BbEVqHco.js";import"./zoom-BWmeO6-E.js";import"./Portal-cEDniDzA.js";import"./useBreakpoint-C1fBIcAO.js";import"./index-BbTjQyva.js";import"./index-CSlYUxik.js";import"./index-Dx4kxOlF.js";import"./useId-C98JHZMn.js";import"./isMobile-DjGTsQxe.js";import"./roundedArrow-S-OOpRVx.js";import"./useLocale-drylJvgs.js";import"./index-317k7Gzh.js";import"./index-efnQCHqG.js";import"./index-DK5P-bAW.js";import"./index-Dyi5F84X.js";import"./fade-BjX83sUK.js";import"./CheckOutlined-C_iRVmUt.js";const Ee=()=>{const p=A("accessToken"),d=A("user").strfDtos[0].busiNum,[f]=Z(),n=Number(f.get("strfId")),x=f.get("category"),w=f.get("edit"),F=W(),h=()=>{F(`/business/store?strfId=${n}&category=${x}&tab=0`)},[v,de]=ee(re),z=v.strfPics.map((e,a)=>({uid:`prev-${a}`,name:e.strfPics,status:"done",url:`${se}/${n}/${e.strfPics}`})),[l,$]=o.useState(z),[D,g]=o.useState(!1),[T,P]=o.useState(!1),[S,C]=o.useState(""),[c,I]=o.useState(""),[i,k]=o.useState(""),[E,B]=o.useState(""),[R,O]=o.useState(0),[U,K]=o.useState(0),[M]=te(),_=async e=>{console.log("form",e);const a={strfId:n,busiNum:d},s=new FormData;if(!l||l.length===0){console.error("fileList가 비어 있습니다!");return}s.append("p",new Blob([JSON.stringify(a)],{type:"application/json"})),(l.length??!1)&&l.forEach(r=>{s.append("strfPic",r.originFileObj)}),l.some(r=>!r.uid.includes("prev"))?X(s):h()},q=({fileList:e})=>{$(e)},G=async e=>{let a=e.url;a||(a=await new Promise(Y=>{const j=new FileReader;j.readAsDataURL(e.originFileObj),j.onload=()=>Y(j.result)}));const s=new Image;s.src=a;const r=window.open(a);r==null||r.document.write(s.outerHTML)},H=e=>{console.log("삭제 선택 file",e),e.uid.includes("prev")&&J(e.name);const a=l.filter(s=>s.uid!==e.uid);$(a)},J=async e=>{const a="/api/detail/strf/pic";try{const r=(await m.delete(`${a}?busiNum=${d}&picName=${e}`,{headers:{Authorization:`Bearer ${p}`}})).data;return r.code==="200 성공"&&console.log("사진 삭제",r),r}catch(s){return console.log("사진 삭제",s),null}},X=async e=>{const a="/api/detail/strf/pic";g(!0);try{const s=await m.patch(`${a}?strfId=${n}&busiNum=${d}`,e,{headers:{Authorization:`Bearer ${p}`}}),r=s.data;return r.code==="200 성공"&&(g(!1),u.success("사진 변경을 성공했습니다"),h()),console.log("사진 변경",s.data),r}catch(s){return console.log("사진 변경",s),u.error("사진 변경에 실패했습니다"),g(!1),null}};o.useEffect(()=>{const e=document.createElement("script");return e.src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js",e.async=!0,document.body.appendChild(e),()=>{document.body.removeChild(e)}},[]);const Q=e=>{console.log("data",e);let a=e.address,s="";e.addressType==="R"&&(e.bname!==""&&(s+=e.bname),e.buildingName!==""&&(s+=s!==""?`, ${e.buildingName}`:e.buildingName),a+=s!==""?` (${s})`:""),C(e.zonecode),B(e.sido),I(a)},L=async e=>{const a="https://dapi.kakao.com/v2/local/search/address";try{const s=await m.get(`${a}?query=${e}`,{headers:{Authorization:"KakaoAK e26abeb161d2171bfd5dabf687976fac"}});return O(Number(s.data.documents[0].y)),K(Number(s.data.documents[0].x)),s.data}catch(s){return console.log("error",s),null}},V=async()=>{const e="/api/detail/address",a={strfId:n,busiNum:d,category:le(x),address:`${c}, ${i}`,locationDetailTitle:E,lat:R,lng:U,post:S};try{const r=(await m.patch(e,a,{headers:{Authorization:`Bearer ${p}`}})).data;console.log("주소 수정",r),r.code==="200 성공"&&(u.success("주소 수정을 성공했습니다"),h())}catch(s){console.log("주소 수정",s),u.error("주소 수정에 실패했습니다")}};return o.useEffect(()=>{if(c&&!i&&L(c),c&&i){const e=`${c}, ${i}`;L(e)}},[c,i]),t.jsx("div",{className:"px-4 py-4",children:t.jsxs(ce,{spinning:D,children:[w==="address"&&t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("h3",{className:"text-slate-700 text-lg font-semibold",children:"업체 주소"}),t.jsx("p",{className:"text-base text-slate-500",children:"고객이 방문할 수 있는 주소를 적어주세요."}),t.jsxs("div",{className:"bg-slate-100 rounded-lg p-4",children:[t.jsx("h5",{className:"text-lg text-slate-700",children:"현재 주소"}),t.jsx("p",{className:"text-base text-slate-600",children:v.address})]})]}),t.jsx("h3",{className:"text-slate-700 text-lg pt-5",children:"변경될 주소"}),t.jsxs("div",{className:"flex items-center gap-3 w-full justify-between",children:[t.jsxs("label",{className:"text-sm text-slate-700 flex items-center gap-3 whitespace-nowrap w-full",children:["우편번호",t.jsx(b,{size:"large",placeholder:"우편번호를 입력해주세요.",className:"w-full",onChange:e=>C(e.target.value),value:S})]}),t.jsx(N,{type:"primary",size:"large",onClick:()=>P(!0),children:"검색"})]}),t.jsxs("label",{className:"text-sm text-slate-700 flex items-center gap-9 whitespace-nowrap w-full",children:["주소",t.jsx(b,{size:"large",placeholder:"주소를 입력해주세요.",className:"w-full",onChange:e=>I(e.target.value),value:c})]}),t.jsxs("label",{className:"text-sm text-slate-700 flex items-center gap-3 whitespace-nowrap w-full",children:["상세주소",t.jsx(b,{size:"large",placeholder:"상세주소를 입력해주세요.",className:"w-full",onChange:e=>k(e.target.value),value:i})]}),T&&t.jsx(ae,{onComplete:Q,onClose:()=>P(!1),style:{height:"450px"}}),t.jsx(N,{type:"primary",className:"text-lg max-h-[50px] h-[16vw]",size:"large",onClick:()=>V(),children:"수정하기"})]}),w==="strfPic"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex flex-col gap-2 pb-5",children:[t.jsx("h3",{className:"text-slate-700 text-lg font-semibold",children:"업체 사진"}),t.jsx("p",{className:"text-base text-slate-500",children:"고객에게 보여질 업체 사진을 등록해주세요."})]}),t.jsxs(y,{form:M,onFinish:_,name:"edit",className:"flex flex-col gap-5",children:[t.jsx(y.Item,{name:"strfPic",rules:[{required:!0,message:"메뉴 사진을 등록해주세요.",validator:()=>l.length>0?Promise.resolve():Promise.reject(new Error("메뉴 사진을 등록해주세요."))}],help:`${oe(x)} 이미지는 다수(최대 5장)을 등록하실 수 있습니다.`,children:t.jsx(ie,{listType:"picture-card",fileList:l,onChange:q,onPreview:G,onRemove:H,beforeUpload:()=>!1,accept:"image/*",maxCount:5,multiple:!0,children:l.length<5&&"+ Upload"})}),t.jsx(y.Item,{children:t.jsx(N,{type:"primary",htmlType:"submit",size:"large",className:"text-lg max-h-[50px] h-[16vw] w-full",children:"등록하기"})})]})]})]})})};export{Ee as default};
