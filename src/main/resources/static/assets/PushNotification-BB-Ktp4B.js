import{r as s,j as e,b as S,u as A,B as $,bx as L,by as _}from"./index-CclgMCKg.js";import{j as I}from"./jwt-Be9xYbvd.js";import{M as z,u as T,P as B,a as H,b as V,L as D,m as K}from"./proxy-luPhEEJa.js";class U extends s.Component{getSnapshotBeforeUpdate(a){const i=this.props.childRef.current;if(i&&a.isPresent&&!this.props.isPresent){const r=i.offsetParent,u=r instanceof HTMLElement&&r.offsetWidth||0,c=this.props.sizeRef.current;c.height=i.offsetHeight||0,c.width=i.offsetWidth||0,c.top=i.offsetTop,c.left=i.offsetLeft,c.right=u-c.width-c.left}return null}componentDidUpdate(){}render(){return this.props.children}}function F({children:n,isPresent:a,anchorX:i}){const r=s.useId(),u=s.useRef(null),c=s.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:p}=s.useContext(z);return s.useInsertionEffect(()=>{const{width:g,height:o,top:j,left:l,right:x}=c.current;if(a||!u.current||!g||!o)return;const h=i==="left"?`left: ${l}`:`right: ${x}`;u.current.dataset.motionPopId=r;const d=document.createElement("style");return p&&(d.nonce=p),document.head.appendChild(d),d.sheet&&d.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${g}px !important;
            height: ${o}px !important;
            ${h}px !important;
            top: ${j}px !important;
          }
        `),()=>{document.head.removeChild(d)}},[a]),e.jsx(U,{isPresent:a,childRef:u,sizeRef:c,children:s.cloneElement(n,{ref:u})})}const G=({children:n,initial:a,isPresent:i,onExitComplete:r,custom:u,presenceAffectsLayout:c,mode:p,anchorX:g})=>{const o=T(W),j=s.useId(),l=s.useCallback(h=>{o.set(h,!0);for(const d of o.values())if(!d)return;r&&r()},[o,r]),x=s.useMemo(()=>({id:j,initial:a,isPresent:i,custom:u,onExitComplete:l,register:h=>(o.set(h,!1),()=>o.delete(h))}),c?[Math.random(),l]:[i,l]);return s.useMemo(()=>{o.forEach((h,d)=>o.set(d,!1))},[i]),s.useEffect(()=>{!i&&!o.size&&r&&r()},[i]),p==="popLayout"&&(n=e.jsx(F,{isPresent:i,anchorX:g,children:n})),e.jsx(B.Provider,{value:x,children:n})};function W(){return new Map}const k=n=>n.key||"";function M(n){const a=[];return s.Children.forEach(n,i=>{s.isValidElement(i)&&a.push(i)}),a}const q=({children:n,custom:a,initial:i=!0,onExitComplete:r,presenceAffectsLayout:u=!0,mode:c="sync",propagate:p=!1,anchorX:g="left"})=>{const[o,j]=H(p),l=s.useMemo(()=>M(n),[n]),x=p&&!o?[]:l.map(k),h=s.useRef(!0),d=s.useRef(l),C=T(()=>new Map),[w,E]=s.useState(l),[t,y]=s.useState(l);V(()=>{h.current=!1,d.current=l;for(let m=0;m<t.length;m++){const f=k(t[m]);x.includes(f)?C.delete(f):C.get(f)!==!0&&C.set(f,!1)}},[t,x.length,x.join("-")]);const N=[];if(l!==w){let m=[...l];for(let f=0;f<t.length;f++){const b=t[f],P=k(b);x.includes(P)||(m.splice(f,0,b),N.push(b))}return c==="wait"&&N.length&&(m=N),y(M(m)),E(l),null}const{forceRender:v}=s.useContext(D);return e.jsx(e.Fragment,{children:t.map(m=>{const f=k(m),b=p&&!o?!1:l===t||x.includes(f),P=()=>{if(C.has(f))C.set(f,!0);else return;let R=!0;C.forEach(O=>{O||(R=!1)}),R&&(v==null||v(),y(d.current),p&&(j==null||j()),r&&r())};return e.jsx(G,{isPresent:b,initial:!h.current||i?void 0:!1,custom:a,presenceAffectsLayout:u,mode:c,onExitComplete:b?void 0:P,anchorX:g,children:m},f)})})},X=({notiDetail:n,isVisible:a,onClose:i})=>e.jsx(q,{children:a&&e.jsx(K.div,{initial:{x:"100%",opacity:0},animate:{x:"50%",opacity:1},exit:{x:"100%",opacity:0},transition:{duration:.3,ease:"easeOut"},className:"fixed top-0 right-1/2  max-w-[768px] w-full h-screen bg-white z-[999]",children:e.jsxs("div",{className:"",children:[e.jsx(S,{icon:"close",onClick:i}),e.jsxs("div",{className:"px-4 text-slate-700 py-4",children:[e.jsx("strong",{className:"text-lg",children:n.title}),e.jsx("p",{className:"text-sm text-slate-400 mt-2 tracking-tight",children:n.noticedAt})]}),e.jsx("div",{className:"px-4 text-slate-700",children:e.jsx("p",{children:n.content})})]})})}),J=n=>({TRIP:e.jsx("img",{src:"/images/notification/luggage_1f9f3.png",alt:"luggage"}),CHAT:e.jsx("img",{src:"/images/notification/speech-balloon_1f4ac.png",alt:"speech-balloon"}),AD:e.jsx("img",{src:"/images/notification/pushpin_1f4cc.png",alt:"pushpin"}),COUPON:e.jsx("img",{src:"/images/notification/ticket_1f3ab.png",alt:"ticket"}),SERVICE:e.jsx("img",{src:"/images/notification/bell_1f514.png",alt:"bell"}),BOOKING:e.jsx(_,{className:"text-3xl"}),POINT:e.jsx(L,{className:"text-3xl"})})[n]||null,Q={TRIP:"여행",CHAT:"채팅",AD:"광고",COUPON:"쿠폰",SERVICE:"서비스",BOOKING:"예약",POINT:"포인트"},te=()=>{const[n,a]=s.useState([]),[i,r]=s.useState(null),[u,c]=s.useState(!1),[p,g]=s.useState(null),[o,j]=s.useState(0),[l,x]=s.useState(!1),h=A(),d=async()=>{try{const t=await I.get(`/api/notice/check?start_idx=${o}`);a(o===0?t.data.data.noticeLines:y=>[...y,...t.data.data.noticeLines]),x(t.data.data.more)}catch(t){console.log(t)}},C=async t=>{try{const y=await I.get(`/api/notice/check-one?notice_id=${t}`);r(y.data.data);const N=n.find(v=>v.noticeId===t);N&&(g(N),c(!0),d())}catch(y){console.log("알림 상세 정보 불러오기 실패:",y)}},w=async()=>{try{const t=await I.put("/api/notice/readAll");console.log(t),d()}catch(t){console.log(t)}};s.useEffect(()=>{o>0&&d()},[o]);const E=()=>{j(t=>t+10)};return s.useEffect(()=>{d()},[]),e.jsxs("div",{children:[e.jsx(S,{title:"알림",icon:"back",onClick:()=>h("/")}),e.jsxs("div",{className:"flex justify-between py-[14px] px-4 border-b-[1px] border-slate-100 ",children:[e.jsxs("p",{className:"text-sm font-semibold text-slate-700",children:["전체 알림 ",n.length]}),e.jsx("p",{className:"text-xs text-slate-500 underline underline-offset-[3px] cursor-pointer",onClick:w,children:"모두 읽음으로 표시"})]}),e.jsx("ul",{children:n==null?void 0:n.map(t=>e.jsxs("li",{onClick:()=>C(t.noticeId),className:`cursor-pointer flex gap-3 px-4 py-5 border-b border-slate-100 last:border-0 ${t.opened===!1?"bg-slate-100":"bg-white"}`,children:[e.jsx("i",{className:"inline-block min-w-[30px] w-8 aspect-square",children:J(t.category)}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-400",children:Q[t.category]||t.category}),e.jsx("p",{className:"text-base font-semibold text-slate-700 my-1 line-clamp-2 leading-5",children:t.txt}),e.jsx("p",{className:"text-sm text-slate-400",children:t.noticedAt})]})]},t.noticeId))}),l&&e.jsx("div",{className:"flex justify-center",children:e.jsx($,{onClick:E,className:"h-auto py-2 px-5 rounded-full text-sm mb-6",children:"더보기"})}),p&&i&&e.jsx(X,{notiDetail:i,isVisible:u,onClose:()=>{c(!1),g(null),r(null)}})]})};export{te as default};
