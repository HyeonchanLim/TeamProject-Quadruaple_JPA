import{r as y,g as L,c as H,u as ie,J as q,j as s,ac as ce,d as C,Q as de,I as _,ah as ue,H as m,m as x,s as me,ag as T,aE as fe}from"./index-DH-Wz4Mj.js";import{s as K}from"./strfAtom-Bf3EDrRj.js";import{f as he,g as F,h as R,e as pe,i as ge,t as xe,c as $e}from"./match-BxFHeRf5.js";import{k as je,T as O}from"./koreaAreaCode-hZ29gBHm.js";import{S}from"./index-DyInUPdd.js";import{S as Y}from"./index-C9J3gJiJ.js";import{P as ye}from"./index-B-C57IxQ.js";import{c as be}from"./customParseFormat-CgFv_ry4.js";import{S as Ce}from"./StrfInfo-bFBrb7h4.js";import"./index-BuUvWuki.js";import"./index-CGzPRLSl.js";import"./index-BynuhZRZ.js";import"./index-C50gSxXV.js";import"./index-Zf4BwBOc.js";import"./PurePanel-DCYXHnde.js";import"./index-KkjKTr2k.js";import"./index-Bl6CWuDB.js";import"./Portal-65BEOyHw.js";import"./useId-3Ovjxdih.js";import"./isMobile-DjGTsQxe.js";import"./Overflow-ChjsdAKz.js";import"./useIcons-BW0Wl4x_.js";import"./CheckOutlined-BQ9MdAo4.js";import"./DownOutlined-DgxMXBCT.js";import"./roundedArrow-C05pmbq5.js";import"./useLocale-DoMzA6HJ.js";import"./motion-DegXBH0O.js";import"./index-BN-dWTgu.js";import"./zoom-U1mf4JTG.js";const ke=({title:$,type:a})=>{const f=L("accessToken"),g=L("user"),d=g.strfDtos[0].busiNum,[D]=H(),u=Number(D.get("strfId")),I=D.get("category"),P=ie(),N=()=>{P(`/business/store/edit?strfId=${u}&category=${I}&edit=${a}`)},[e,j]=q(K),[h,z]=y.useState(!1),[A,i]=y.useState(!1),[r,c]=y.useState(null),[v,Q]=y.useState("weekly"),[w,B]=y.useState(""),U=t=>{(r==null?void 0:r.includes(t))===!0?c(l=>[...l.filter(o=>o!==t)]):c(l=>[...l,t])},k=async()=>{const t="/api/detail/member";i(!0);try{const o=(await x.get(`${t}?strf_id=${u}`,{headers:{Authorization:`Bearer ${f}`}})).data;if(o){const n=o.data.tell.split("-");j(p=>({...p,...o.data,areaCode:n[0],tell:`${n[1]}-${n[2]}`})),me("user",{...g,strfDtos:[{...g.strfDtos[0],title:o.data.strfTitle}]}),i(!1)}return o}catch(l){return i(!1),console.log("상품조회",l),null}},J=async()=>{const t="/api/detail/title",l={strfId:u,busiNum:d,title:r};console.log("payload",l),i(!0);try{const n=(await x.patch(`${t}?strfId=${u}&title=${r}&busiNum=${d}`,l,{headers:{Authorization:`Bearer ${f}`}})).data;return console.log(n),n&&(k(),i(!1),j({...e,strfTitle:r}),m.success("업체명 변경이 변경되었습니다")),n}catch(o){return console.log("이름 변경",o),i(!1),m.error("업체명 변경에 실패했습니다."),null}},M=async()=>{const t="/api/detail/state",l={strfId:u,busiNum:d,state:r};console.log("payload",l),i(!0);try{const n=(await x.patch(`${t}?strfId=${u}&state=${r}&busiNum=${d}`,l,{headers:{Authorization:`Bearer ${f}`}})).data;return console.log("영업 상태 변경",n),n.code==="200 성공"&&(i(!1),k(),j(p=>({...p,state:r})),m.success("영업 상태 변경에 성공했습니다.")),n}catch(o){return console.log("영업 상태 변경",o),m.error("영업 상태 변경에 실패했습니다."),i(!1),null}},G=async()=>{const t="/api/detail/tell";i(!0);const l={strfId:u,tell:`${w}-${r}`,busiNum:d};try{const n=(await x.patch(`${t}?strfId=${u}&tell=${w}-${r}&busiNum=${d}`,l,{headers:{Authorization:`Bearer ${f}`}})).data;return n.code&&(i(!1),k(),j({...e,areaCode:w,tell:r.split("-",1)}),m.success("전화번호 변경이 완료되었습니다")),console.log("전화번호 변경",n),n}catch(o){return i(!1),m.error("전화번호 변경에 실패하였습니다"),console.log("전화번호 변경",o),null}},W=async()=>{const t="/api/detail/detail";i(!0);const l={strfId:u,detail:r,busiNum:d};try{const n=(await x.patch(`${t}?strfId=${u}&detail=${r}&busiNum=${d}`,l,{headers:{Authorization:`Bearer ${f}`}})).data;return n.code&&(i(!1),k(),j(p=>({...p,detail:r})),m.success("업체 소개 변경이 완료되었습니다")),console.log("업체소개 변경",n),n}catch(o){return i(!1),m.error("업체소개 변경에 실패하였습니다"),console.log("업체소개 변경",o),null}},X=async()=>{const t="/api/detail/amenity";i(!0);const l={strfId:u,busiNum:d,category:$e(I),ameniPoints:r},o=e.amenity.map(n=>`ameniPoints=${n}`);console.log("보낼 파라메터",o.join("&"));try{const p=(await x.patch(`${t}?strfId=${u}&busiNum=${d}&category=${I}&${o.join("&")}`,l,{headers:{Authorization:`Bearer ${f}`}})).data;return p.code&&(i(!1),k(),m.success("편의시설 변경이 완료되었습니다")),console.log("편의시설 변경",p),p}catch(n){return i(!1),m.error("편의시설 변경에 실패하였습니다"),console.log("편의시설 변경",n),null}},Z=async()=>{const t="/api/detail/amenity/all";try{const o=(await x.delete(`${t}?strfId=${u}&busiNum=${d}`,{headers:{Authorization:`Bearer ${f}`}})).data;o&&(console.log("편의시설 삭제",o),X())}catch(l){console.log("편의시설 삭제",l)}},ee=async()=>{const t="/api/detail/time",l={strfId:u,busiNum:d,openCheckIn:r[0],closeCheckOut:r[1]};console.log("payload",l),i(!0);try{const n=(await x.patch(`${t}?strfId=${u}&busiNum=${d}&openCheckIn=${r[0]}&closeCheckOut=${r[1]}`,l,{headers:{Authorization:`Bearer ${f}`}})).data;return console.log("체크시간 변경",n),n&&(k(),i(!1),j({...e,strfTitle:C(r[0]).format("HH:mm"),closeCheck:C(r[1]).format("HH:mm")}),m.success("체크시간 변경이 변경되었습니다")),n}catch(o){return console.log("체크시간 변경",o),i(!1),m.error("체크시간 변경에 실패했습니다."),null}},te=async()=>{const t="/api/detail/fest/time",l={strfId:u,busiNum:d,startAt:e.startAt,endAt:e.endAt};console.log("payload",l),i(!0);try{const n=(await x.put(`${t}?strfId=${u}&busiNum=${d}&startAt=${e.startAt}&endAt=${e.endAt}`,l,{headers:{Authorization:`Bearer ${f}`}})).data;return console.log("기간 변경",n),n&&(k(),i(!1),j({...e,strfTitle:r}),m.success("기간이 변경되었습니다")),n}catch(o){return console.log("기간 변경",o),i(!1),m.error("기간 변경에 실패했습니다."),null}},se=async()=>{const t="/api/detail/rest",l=r.map(p=>ge(p)),o=l;console.log("payload",o),i(!0);const n=l.map(p=>`restDates=${p}`).join("&");console.log("restDatesPara",n);try{const E=(await x.patch(`${t}?strf_id=${u}&busi_num=${d}`,o,{headers:{Authorization:`Bearer ${f}`}})).data;return console.log("휴무일 변경",E),E&&(k(),i(!1),j(ne=>({...ne,restDate:xe(r)})),m.success("휴무일이 변경되었습니다")),E}catch(p){return console.log("휴무일 변경",p),i(!1),m.error("휴무일 변경에 실패했습니다."),null}},ae=()=>{if(a==="strfPic"){N();return}if(a==="address"){N();return}z(!h),h===!1&&(a==="title"&&c(e.strfTitle),a==="tell"&&c(e.tell),a==="tell"&&B(e.areaCode??""),a==="detail"&&c(e.detail),a==="amenity"&&c(e.amenity),a==="state"&&c(e.state),a==="duration"&&c(`${e.startAt}~${e.endAt}`),a==="checkTime"&&c([e.openCheck,e.closeCheck]),a==="restDate"&&c(e.restDate.map(t=>R(t)))),h===!0&&(a==="title"&&(r===e.strfTitle?m.warning("동일한 이름으로 수정을 취소합니다"):(r==null?void 0:r.trim())!==""&&J()),a==="state"&&(r===e.state?m.warning("동일한 상태이기 때문에 수정을 취소합니다"):M()),a==="tell"&&(w===e.areaCode&&r===e.tell?m.warning("동일한 전화번호이기 때문에 수정을 취소합니다"):w!==""&&r!==""&&G()),a==="detail"&&(r===e.detail?m.warning("동일한 상품소개이기 때문에 수정을 취소합니다"):r.trim()!==""&&W()),a==="amenity"&&Z(),a==="duration"&&te(),a==="checkTime"&&ee(),a==="restDate"&&se())},re=[{value:0,label:"영업중"},{value:1,label:"휴업"},{value:2,label:"폐업"}],le=s.jsx(S,{defaultValue:e.areaCode,onChange:t=>{B(t)},children:je.map(t=>s.jsx(S.Option,{value:t.code,children:t.code},t.code))}),oe=t=>{const o=t.replace(/[^\d]/g,"").slice(0,7);return o.length>3?`${o.slice(0,3)}-${o.slice(3)}`:o},V={frequency:[{label:"없음",value:"none"},{label:"매주",value:"weekly"}],day:[{label:"월",value:"월"},{label:"화",value:"화"},{label:"수",value:"수"},{label:"목",value:"목"},{label:"금",value:"금"},{label:"토",value:"토"},{label:"일",value:"일"}]};return y.useEffect(()=>{if(a==="tell"&&typeof e.tell=="string"){const t=e.tell?e.tell.split("-"):["000","0000","0000"];B(t[0]),c(`${t[1]}-${t[2]}`)}a==="detail"&&typeof e.detail=="string"&&c(e.detail),a==="amenity"&&c([...e.amenity])},[e,a]),s.jsxs("section",{className:"px-7 pt-4 pb-5 flex flex-col gap-2 border-b-2 border-slate-100",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-xl font-semibold text-slate-700",children:$}),s.jsxs("button",{type:"button",className:"flex items-center gap-1 text-primary font-semibold hover:text-primary2 transition-all duration-300",onClick:ae,children:[!h&&s.jsxs(s.Fragment,{children:[s.jsx(ce,{}),"변경"]}),h&&s.jsx(s.Fragment,{children:"완료"})]})]}),s.jsxs(Y,{spinning:A,children:[!h&&s.jsxs("div",{className:"text-lg font-medium text-slate-500 px-2 py-1",children:[a==="title"&&e.strfTitle,a==="state"&&he(e.state),a==="tell"&&(e.areaCode?`${e.areaCode}-${e.tell}`:`${e.tell}`),a==="detail"&&e.detail,a==="amenity"&&s.jsx("ul",{className:"flex flex-wrap items-center gap-3 ",children:e.amenity.map((t,l)=>l<e.amenity.length-1?s.jsxs("li",{children:[F(t),","]},l):s.jsx("li",{children:F(t)},l))}),a==="duration"&&`${e.startAt}~${e.endAt}`,a==="checkTime"&&e.openCheck&&e.closeCheck&&`${C(e.openCheck,"HH:mm:ss").format("HH:mm")}~${C(e.closeCheck,"HH:mm:ss").format("HH:mm")}`,a==="restDate"&&e.restDate.map((t,l)=>l===e.restDate.length-1?s.jsx("span",{children:R(t)},l):s.jsxs("span",{children:[R(t),", "]},l)),a==="strfPic"&&s.jsx("ul",{className:"flex gap-2",children:e.strfPics.map((t,l)=>s.jsx("li",{className:"bg-slate-100 rounded-lg overflow-hidden w-full max-h-[200px] h-[53.33vw]",children:s.jsx("img",{src:`${de}/${u}/${t.strfPics}`,alt:t.strfPics,className:"w-full h-full object-cover"})},l))}),a==="address"&&e.address]}),h&&a==="title"&&s.jsx(_,{size:"large",defaultValue:e.strfTitle,placeholder:"업체 이름을 입력해주세요(공백 입력시 이전 이름이 유지됩니다)",onChange:t=>{c(t.target.value)},status:(r==null?void 0:r.trim())===""?"error":void 0}),h&&a==="state"&&s.jsx(S,{defaultValue:e.state,options:re,size:"large",className:"w-1/3 ",onChange:t=>c(t)}),h&&a==="tell"&&s.jsx(_,{addonBefore:le,size:"large",defaultValue:e.tell,placeholder:"전화번호를 입력해주세요.",onChange:t=>c(t.target.value),value:oe(r??"0"),maxLength:8,status:!w||!r?"error":void 0}),h&&a==="detail"&&s.jsx(ue,{placeholder:"업체 소개를 작성해주세요",maxLength:300,onChange:t=>{c(t.target.value)},style:{resize:"none",height:"27.73vw",padding:"20px"},value:r,status:(r==null?void 0:r.trim())===""?"error":void 0}),h&&a==="amenity"&&s.jsx("div",{className:"flex flex-wrap gap-2",children:pe.map((t,l)=>s.jsxs("button",{type:"button",className:`flex text-base items-center gap-2
                          border rounded-2xl w-fit px-2 py-1
                          ${r.includes(t.amenity_id)?"border-primary text-primary":"border-slate-300 text-slate-500"}`,onClick:()=>U(t.amenity_id),children:[t.icon,t.key]},l))}),h&&a==="busiHour"&&s.jsx("div",{children:s.jsx(O.RangePicker,{defaultValue:[C(e.startAt),C(e.endAt)],format:"HH:mm"})}),h&&a==="checkTime"&&s.jsx("div",{children:s.jsx(O.RangePicker,{defaultValue:[C(e!=null&&e.openCheck&&e.openCheck!==""?e.openCheck:"00:00","HH:mm"),C(e!=null&&e.closeCheck&&e.closeCheck!==""?e.closeCheck:"00:00","HH:mm")],minuteStep:10,format:"HH:mm",onChange:t=>{t&&c([t[0]?t[0].format("HH:mm"):"",t[1]?t[1].format("HH:mm"):""])}})}),h&&a==="restDate"&&s.jsxs("div",{className:"flex gap-3",children:[s.jsx(S,{options:V.frequency,placeholder:"휴무 주기",defaultValue:"weekly",size:"large",onChange:t=>{t==="none"&&j({...e,restDate:[]}),Q(t)}}),s.jsx(S,{options:V.day,placeholder:"요일 선택",size:"large",mode:"multiple",allowClear:!0,className:"w-full",value:r,onChange:t=>{c(t)},disabled:v==="none"})]})]})]})},b=y.memo(ke),Ae=()=>{const[$]=H(),a=$.get("category");return s.jsxs(s.Fragment,{children:[s.jsx(b,{title:"업체 이름",type:"title"}),s.jsx(b,{title:"업체 전화번호",type:"tell"}),s.jsx(b,{title:"업체 소개",type:"detail"}),a===T.STAY&&s.jsx(b,{title:s.jsxs("span",{className:"flex items-center gap-2",children:["업체 편의 정보"," ",s.jsx(ye,{trigger:"hover",placement:"right",content:"* 검색 시 사용되는 정보입니다.",children:s.jsx("button",{type:"button",children:s.jsx(fe,{className:"text-lg text-slate-300 cursor-help"})})})]}),type:"amenity"}),s.jsx(b,{title:"업체 주소",type:"address"}),s.jsx(b,{title:"업체 사진",type:"strfPic"})]})};C.extend(be);const Te=({})=>{const[$]=H(),a=$.get("category"),f=g=>{if(g===T.STAY)return"입실/퇴실 시간";if(g===T.RESTAURANT)return"영업 시간";if(g===T.TOUR||T.FEST)return"개장 시간"};return s.jsxs(s.Fragment,{children:[a===T.FEST&&s.jsx(b,{title:"축제 기간",type:"duration"}),s.jsx(b,{title:"업체 상태",type:"state"}),s.jsx(b,{title:f(a),type:"checkTime"}),s.jsx(b,{title:"휴무일",type:"restDate"})]})},Ne=({list:$,current:a,changeCateIndex:f})=>s.jsxs("div",{className:"flex flex-col gap-3 mb-1",children:[s.jsx("section",{children:s.jsx("ul",{className:"flex items-center w-full",children:$.map((g,d)=>s.jsxs("li",{className:`w-full flex items-center justify-center gap-2 text-lg font-semibold py-2 cursor-pointer
          ${a===d?"text-primary border-b-4 border-primary":"text-slate-400 border-b-2 border-slate-200"}
          transition-all duration-300`,onClick:()=>{f(d)},children:[g.icon,g.label]},d))})}),s.jsx("section",{children:$[a].children})]}),st=()=>{const $=L("accessToken"),[a]=H(),f=a.get("strfId"),g=a.get("category"),d=Number(a.get("tab")),[,D]=q(K),[u,I]=y.useState(d),[P,N]=y.useState(!1),e=async()=>{const A="/api/detail/member";N(!0);try{const r=(await x.get(`${A}?strf_id=${f}`,{headers:{Authorization:`Bearer ${$}`}})).data;if(r){const c=r.data.tell.split("-");D(v=>({...v,...r.data,areaCode:c[0],tell:`${c[1]}-${c[2]}`})),N(!1)}return r}catch(i){return N(!1),console.log("상품조회",i),null}},j=async()=>{const A="/api/detail/amenity";try{const r=(await x.get(`${A}?strf_id=${f}&category=숙소`,{headers:{Authorization:`Bearer ${$}`}})).data;return D(c=>({...c,amenity:r.data.map(v=>v.amenityId)})),r}catch{return null}},h=[{label:s.jsx("p",{children:"기본 정보"}),children:s.jsx(Ae,{})},{label:s.jsx("p",{children:"운영 정보"}),children:s.jsx(Te,{})}],z=A=>{I(A)};return y.useEffect(()=>{e(),g===T.STAY&&j()},[]),s.jsxs("div",{children:[s.jsx(Ce,{}),s.jsx(Y,{spinning:P,children:s.jsx(Ne,{list:h,changeCateIndex:z,current:u})})]})};export{st as default};
