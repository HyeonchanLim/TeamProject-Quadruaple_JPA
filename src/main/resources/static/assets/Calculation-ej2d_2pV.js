import{r as n,c as T,g as B,j as e,a5 as L,m as P,B as $,H as I,u as U,T as z,a8 as V,a9 as M}from"./index-DH-Wz4Mj.js";import{a as A}from"./index-CGzPRLSl.js";import{M as D}from"./index-KItVmuuQ.js";import{j as O}from"./jwt-DnEXN_lJ.js";/* empty css                    */import{e as H}from"./index-BuUvWuki.js";import{B as q}from"./BottomSheet-DU6y7FlW.js";import"./motion-DegXBH0O.js";import"./index-C3h-G8YL.js";import"./Portal-65BEOyHw.js";import"./useId-3Ovjxdih.js";import"./index-DhdEoO5n.js";import"./fade-BkDnt_Sp.js";import"./zoom-U1mf4JTG.js";import"./context-Crh7wlVT.js";import"./Skeleton-BOmxZydq.js";import"./useLocale-DoMzA6HJ.js";import"./PurePanel-DCYXHnde.js";import"./proxy-AvwZpyC7.js";const G=({deId:l,isReceipt:d,editPaymentOpen:f,setEditPaymentOpen:b,getStatement:N})=>{const[c,x]=n.useState(0),[p,h]=n.useState(""),[j]=T(),[u,y]=n.useState([]),v=j.get("tripId"),m=B("accessToken"),g=async()=>{try{const a=await P.get(`/api/expense/trip_user?de_id=${l}&trip_id=${v}`,{headers:{Authorization:`Bearer ${m}`}});console.log("Received data:",a.data.data),y(a.data.data)}catch(a){console.log("âœ…  error:",a)}};n.useEffect(()=>{x(d.totalPrice),h(d.paidFor)},[d]);const r=async()=>{const a=u.filter(({is_join:o})=>o).map(({user_id:o})=>o),s={total_price:c,paid_user_list:a,de_id:l,paid_for:p,trip_id:v};try{const o=await P.put("/api/expense",s,{headers:{Authorization:`Bearer ${m}`}});b(!1),N()}catch(o){console.log("âœ…  error:",o,s)}};n.useEffect(()=>{f&&g()},[f]);const k=a=>{let s=a.target.value.replace(/\D/g,"");x(s)},_=()=>{x(d.totalPrice),h(d.paidFor),b(!1)},C=()=>{if(!c||c<=0){message.error("ì§€ì¶œ ê¸ˆì•¡ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤."),x(d.totalPrice);return}p.trim()||h(d.paidFor),r()},S=a=>{y(s=>s.map(o=>o.user_id===a.user_id?{...o,is_join:!o.is_join}:o))};return e.jsxs(D,{title:"ê²°ì œ ìˆ˜ì •",open:f,onCancel:_,onOk:C,className:"custom-modal",children:[e.jsx("p",{className:"text-lg text-slate-500 font-semibold px-8",children:"ì§€ì¶œ ê¸ˆì•¡"}),e.jsxs("label",{htmlFor:"",className:"flex px-8 mt-3 mb-10",children:[e.jsx("input",{type:"text",name:"expenditurePice",value:c,placeholder:"0",onChange:k,className:"w-11/12 !border-none !border-transparent outline-0 !shadow-none text-4xl font-bold text-slate-700 !text-right  "}),e.jsx("span",{className:"text-4xl font-bold text-slate-700",children:"ì›"})]}),e.jsxs("label",{htmlFor:"",className:"text-lg text-slate-500 font-semibold px-8 w-full inline-block",children:["ì§€ì¶œ ë‚´ìš©",e.jsx("input",{type:"text",name:"expenditureName",value:p,onChange:a=>h(a.target.value),className:"h-20 w-full border border-slate-300 rounded-2xl px-5 mt-3 text-2xl text-slate-700 outline-none"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"px-8 w-full py-5 border-y border-slate-200 text-lg font-semibold text-slate-500 mt-8",children:"ì°¸ì—¬ì"}),u.map(a=>e.jsxs("div",{className:"flex items-center mt-8 justify-between px-8",children:[e.jsxs("div",{className:"flex items-center gap-5 ",children:[e.jsx("p",{className:"w-16 h-16 rounded-full overflow-hidden",children:e.jsx("img",{src:`${L}/${a==null?void 0:a.user_id}/${a.profile_pic}`,alt:a.name})}),e.jsx("p",{className:"text-lg text-slate-700 font-semibold",children:a.name})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"peer hidden",checked:a.is_join,onChange:()=>S(a)}),e.jsx("div",{className:"w-11 h-11 bg-slate-100 text-slate-400 rounded-full flex items-center justify-center transition duration-300 peer-checked:bg-primary2 peer-checked:text-primary peer-checked:bg-opacity-50",children:e.jsx(A,{className:"text-2xl duration-75"})})]})]},a.user_id))]})]})},E=({isOpen:l,setIsOpen:d,deId:f,tripId:b,getStatement:N})=>{var v,m,g;const[c,x]=n.useState([]),[p,h]=n.useState(!1),j=async()=>{try{const r=await O.get(`/api/expense/select?de_id=${f}&trip_id=${b}`);console.log("âœ… ìµœì‹  ë°ì´í„°:",r.data.data),x(r.data.data)}catch(r){console.log("âœ…  error:",r)}};n.useEffect(()=>{j()},[l]);const u=()=>{h(!0),d(!1)},y=()=>{d(!1)};return e.jsxs("div",{children:[e.jsx(D,{title:"ê³„ì‚°ì„œ",open:l,onOk:u,onCancel:y,closable:!1,className:"custom-modal",footer:[e.jsx($,{type:"primary",onClick:u,children:"ìˆ˜ì •"},"submit"),e.jsx($,{onClick:y,children:"í™•ì¸"},"back")],children:e.jsxs("div",{className:"px-8 pb-5",children:[e.jsxs("h1",{className:"text-lg font-semibold text-slate-700 flex items-end gap-3 py-6",children:["ğŸ§¾",c.paidFor]}),e.jsxs("div",{children:[e.jsxs("div",{className:"py-4 flex justify-between items-center border-t-2 border-dashed border-slate-500",children:[e.jsx("h2",{className:"text-base text-slate-400 font-semibold",children:"ê²°ì œ ê¸ˆì•¡"}),e.jsxs("p",{className:"text-lg font-semibold text-slate-700",children:[(v=c.totalPrice)==null?void 0:v.toLocaleString(),"ì›"]})]}),e.jsxs("div",{className:"py-4 flex justify-between items-center border-b-2 border-dashed border-slate-500",children:[e.jsx("p",{className:"text-base text-slate-400 font-semibold",children:"ì´ ì§€ì¶œì•¡"}),e.jsxs("p",{className:"text-lg font-semibold text-slate-700",children:[(m=c.totalPrice)==null?void 0:m.toLocaleString(),"ì›"]})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-base text-slate-400 font-semibold py-5",children:"ì •ì‚° ë‚´ì—­"}),e.jsx("div",{children:(g=c==null?void 0:c.payList)==null?void 0:g.map(r=>{var k;return e.jsxs("div",{className:"flex items-center py-5",children:[e.jsxs("div",{className:"flex items-center gap-[6px] mr-auto",children:[e.jsx("p",{className:"w-8 h-8 rounded-full overflow-hidden",children:e.jsx("img",{src:`${L}/${r==null?void 0:r.userId}/${r==null?void 0:r.profilePic}`,alt:r.name})}),e.jsx("p",{className:"text-base text-slate-700 font-semibold",children:r.name})]}),e.jsxs("p",{className:"text-base text-slate-700",children:[(k=r.price)==null?void 0:k.toLocaleString(),"ì›"]})]},r.userId)})})]})]})}),p&&e.jsx(G,{isReceipt:c,editPaymentOpen:p,setEditPaymentOpen:h,deId:f,getStatement:N})]})},J=({tripId:l,deId:d,isOpen:f,setIsOpen:b,getStatement:N})=>{const[c,x]=n.useState(0),[p,h]=n.useState(""),[j,u]=n.useState({}),[y,v]=n.useState([]),[m,g]=n.useState(!1),[r,k]=n.useState(null),_=B("accessToken"),C=async()=>{try{const t=await P.get(`/api/expense/trip_user?&trip_id=${l}`,{headers:{Authorization:`Bearer ${_}`}});v(t.data.data)}catch(t){console.log("âœ…  error:",t)}},S=async()=>{var i;const t={trip_id:l,total_price:c,paid_user_list:Object.keys(j).filter(w=>j[w]).map(Number),paid_for:p};try{const w=await P.post("/api/expense",t,{headers:{Authorization:`Bearer ${_}`,"Content-Type":"application/json"}});return k(w.data.data),g(!0),b(!1),I.success("ì¶”ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤"),w.data.data}catch(w){console.log("âœ…  error:",(i=w.response)==null?void 0:i.data,t)}};n.useEffect(()=>{C()},[]);const a=t=>{u(i=>({...i,[t]:!i[t]})),console.log(t)},s=async()=>{if(!p.trim())return I.error("ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”");if(Number(c)<1e3)return I.error("ê°€ê²©ì€ 1000ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤");await S()&&(g(!0),b(!1)),N(),x("0"),h(""),u({})},o=()=>{b(!1),x("0"),h(""),u({})};return e.jsxs("div",{children:[e.jsx(D,{title:"ì •ì‚°í•˜ê¸°",open:f,closable:!1,className:"custom-modal",footer:[e.jsx($,{onClick:o,children:"ì·¨ì†Œ"},"back"),e.jsx($,{type:"primary",onClick:s,children:"ì¶”ê°€"},"submit")],children:e.jsxs("div",{children:[e.jsxs("div",{className:"mb-3 px-4",children:[e.jsx("p",{className:"text-sm text-slate-500 pl-1",children:"ì§€ì¶œ ê¸ˆì•¡"}),e.jsxs("label",{htmlFor:"",className:"flex items-center",children:[e.jsx("input",{type:"text",name:"expenditurePice",value:isNaN(Number(c))?"0":Number(c).toLocaleString(),placeholder:"0",onChange:t=>x(t.target.value.replace(/\D/g,"")),className:"h-auto w-full border border-slate-200 rounded-lg px-5 py-[14px] mt-1 text-lg text-slate-700 outline-none"}),e.jsx("span",{className:"pl-1 text-lg font-semibold text-slate-700",children:"ì›"})]})]}),e.jsx("div",{className:"px-4 mb-6",children:e.jsxs("label",{htmlFor:"",className:"text-slate-500 pl-1",children:["ì§€ì¶œ ë‚´ìš©",e.jsx("input",{type:"text",name:"expenditureName",value:p,onChange:t=>h(t.target.value),className:"h-auto w-full border border-slate-200 rounded-lg px-5 py-[14px] mt-1 text-lg text-slate-700 outline-none"})]})}),e.jsx("section",{className:"w-full h-[10px] bg-slate-100"}),e.jsxs("div",{children:[e.jsx("p",{className:"px-4 w-full py-3 text-lg font-semibold text-slate-500",children:"ì°¸ì—¬ì"}),y.map(t=>e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3 ",children:[e.jsx("p",{className:"w-9 h-9 rounded-full overflow-hidden",children:e.jsx("img",{src:`${L}/${t==null?void 0:t.user_id}/${t.profile_pic}`,alt:t.name,className:"w-full h-full object-cover"})}),e.jsx("p",{className:"text-base text-slate-700 font-semibold",children:t.name})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"peer hidden",checked:j[t.user_id]||!1,onChange:()=>a(t==null?void 0:t.user_id)}),e.jsx("div",{className:"w-8 h-8 bg-slate-100 text-slate-400 rounded-full flex items-center justify-center transition duration-100 peer-checked:bg-primary2 peer-checked:text-primary peer-checked:bg-opacity-50",children:e.jsx(A,{className:"text-base duration-75"})})]})]},t.user_id))]})]})}),e.jsx(E,{isOpen:m,setIsOpen:g,deId:r,tripId:l,getStatement:N})]})},pe=()=>{var _,C,S,a;const[l,d]=n.useState([]),[f,b]=n.useState(null),[N,c]=n.useState(!1),[x,p]=n.useState(!1),[h,j]=n.useState(!1),[u,y]=n.useState(null),[v]=T(),m=v.get("tripId");B("accessToken");const g=U(),r=async()=>{try{const s=await O.get(`/api/expense?trip_id=${m}`);d(s.data.data),console.log(" ê°€ê³„ë¶€ ë³´ê¸°",s.data.data)}catch(s){console.log("âœ…  error:",s)}},k=async s=>{try{const o=await O.delete("/api/expense",{data:{de_id:s,trip_id:m}});I.success("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."),r()}catch(o){console.log("âœ…  error:",o),I.error("ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}};return n.useEffect(()=>{r()},[]),e.jsxs("div",{children:[e.jsx(z,{icon:"back",title:`${l==null?void 0:l.title}`,onClick:()=>g(-1)}),e.jsxs("div",{children:[e.jsxs("div",{className:"py-3",children:[e.jsx("div",{className:" flex items-end gap-3 px-4 pb-[6px]",children:e.jsx("span",{className:"text-xs text-slate-400",children:(_=l==null?void 0:l.tripPeriod)==null?void 0:_.replace(/-/g,".")})}),e.jsxs("div",{className:"px-4 py-3 border-b border-slate-100",children:[e.jsxs("h3",{className:"flex gap-[6px] text-base text-slate-700 mb-[6px]",children:[e.jsx(H,{className:"text-slate-300 text-2xl"}),"ë‚´ê°€ ì“´ ê¸ˆì•¡"]}),e.jsxs("h2",{className:"text-2xl text-primary font-semibold",children:[(C=l==null?void 0:l.myTotalPrice)==null?void 0:C.toLocaleString(),"ì›"]})]}),e.jsxs("div",{className:"py-3 px-4 flex",children:[e.jsx("h1",{className:"text-base text-slate-500 mr-auto",children:"ì´ ì§€ì¶œ ê¸ˆì•¡"}),e.jsxs("span",{className:"text-base font-semibold text-slate-700",children:[(S=l==null?void 0:l.tripTotalPrice)==null?void 0:S.toLocaleString(),"ì›"]})]})]}),e.jsx("section",{className:"w-full h-[10px] bg-slate-100"}),e.jsx("div",{children:(a=l==null?void 0:l.expensedList)==null?void 0:a.map(s=>{var o,t;return e.jsxs("div",{onClick:()=>{b(s.deId),p(!0)},className:"flex justify-between items-center py-6 px-4",children:[e.jsxs("div",{className:"flex justify-between w-full ",children:[e.jsxs("div",{className:"flex flex-col justify-between cursor-pointer",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-500",children:s.paidFor||"í•­ëª© ì—†ìŒ"}),e.jsxs("div",{className:"flex items-center gap-1 mt-5",children:[(o=s==null?void 0:s.paidUserInfoList)==null?void 0:o.slice(0,3).map((i,w)=>{var F;return e.jsxs("span",{className:"inline-block w-10 h-10 !border-[3px] border-white rounded-full overflow-hidden -ml-5 first:ml-0 ",style:{zIndex:9-w},children:[e.jsx("img",{src:`${L}/${i==null?void 0:i.user_id}/${i==null?void 0:i.profile_pic}`,alt:i.name}),w!==((F=s.paidUserInfoList)==null?void 0:F.length)-1&&", "]},i.user_id)}),e.jsx("span",{className:"text-sm text-slate-500",children:s.paidUserInfoList.length===1?`${(t=s.paidUserInfoList[0])==null?void 0:t.name}`:`ì™¸ ${s.paidUserInfoList.length-1}ëª…`})]})]}),e.jsxs("div",{className:"flex flex-col justify-center items-end",children:[e.jsx("span",{className:"text-lg text-slate-500 font-semibold",children:s==null?void 0:s.paidUserList}),e.jsxs("p",{className:"text-lg text-slate-700 font-semibold",children:[(s.totalPrice||0).toLocaleString(),"ì›"]}),e.jsxs("p",{className:"text-xs text-primary",children:[(s.myPrice||0).toLocaleString(),"ì›"]})]})]}),e.jsx(V,{onClick:i=>{i.stopPropagation(),y(s.deId),j(!0)},className:"text-2xl text-slate-400 ml-3"})]},s.deId)})}),e.jsx("div",{className:"sticky bottom-0 bg-white p-4 border-t border-slate-100 z-50",children:e.jsx($,{type:"primary",className:"h-16 w-full rounded-2xl text-xl ",onClick:()=>c(!0),children:"ë¹„ìš© ì¶”ê°€"})})]}),e.jsx(q,{open:h,onClose:()=>j(!1),actions:[{label:e.jsxs("div",{className:"flex items-center gap-3 text-lg",children:[e.jsx(M,{className:"text-slate-400"}),"ì‚­ì œí•˜ê¸°"]}),onClick:()=>{u&&(k(u),j(!1))}}]}),N&&e.jsx(J,{tripId:m,deId:f,isOpen:N,setIsOpen:c,getStatement:r}),x&&e.jsx(E,{isOpen:x,setIsOpen:p,deId:f,tripId:m,getStatement:r})]})};export{pe as default};
