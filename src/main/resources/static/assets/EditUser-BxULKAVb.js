import{g as h,u as L,r as l,j as s,b as S,ab as R,an as k,I as x,B as z,m as g,d as B,X as C}from"./index-CclgMCKg.js";import{F as i}from"./index-Y7Vl51Ml.js";import{S as O}from"./index-DzJzb7gE.js";import{U as T}from"./index-BfZ_5wYh.js";import{D as q}from"./index-C8fV_4ml.js";import"./motion-BtiDeT7c.js";import"./collapse-BbEVqHco.js";import"./zoom-BWmeO6-E.js";import"./Portal-cEDniDzA.js";import"./useBreakpoint-C1fBIcAO.js";import"./index-BbTjQyva.js";import"./index-CSlYUxik.js";import"./index-Dx4kxOlF.js";import"./useId-C98JHZMn.js";import"./isMobile-DjGTsQxe.js";import"./roundedArrow-S-OOpRVx.js";import"./useLocale-drylJvgs.js";import"./fade-BjX83sUK.js";import"./CheckOutlined-C_iRVmUt.js";import"./customParseFormat--lJaNAof.js";import"./PurePanel-C1JE1xpr.js";import"./Overflow-b40CqTdl.js";import"./useIcons-Bg9STVks.js";import"./DownOutlined-eQ1uAPVl.js";const de=()=>{const j=h("user").userId,m=h("accessToken"),d=L(),[b,p]=l.useState(!1),[w,N]=l.useState(""),[n,P]=l.useState([]),[y,F]=l.useState(""),[o]=i.useForm(),u=async()=>{const r="/api/user/userInfo";try{const t=(await g.get(r,{headers:{Authorization:`Bearer ${m}`}})).data;t&&(o.setFieldValue("name",t.data.name),o.setFieldValue("tell",f(t.data.tell)),t.data.birth&&o.setFieldValue("birth",B(t.data.birth)),N(t.data.profilePic)),console.log("유저 정보",t)}catch(e){console.log("유저 정보 조회",e)}},I=async r=>{const e="/api/user";p(!0);try{(await g.patch(e,r,{headers:{Authorization:`Bearer ${m}`}})).data&&(C.success("프로필이 수정되었습니다."),u(),d(-1))}catch(t){console.log("유저 정보 수정",t)}finally{p(!1)}},v=r=>{var a;const e={name:r.name,tell:r.tell,birth:r.birth},t=new FormData;t.append("p",new Blob([JSON.stringify(e)],{type:"application/json"})),(a=n[0])!=null&&a.originFileObj&&t.append("profilePic",n[0].originFileObj),I(t)},U=({fileList:r})=>{var e;if(P(r),(e=r[0])!=null&&e.originFileObj){const t=new FileReader;t.onload=()=>{F(t.result)},t.readAsDataURL(r[0].originFileObj)}},$=async r=>{let e=r.url;e||(e=await new Promise(D=>{const c=new FileReader;c.readAsDataURL(r.originFileObj),c.onload=()=>D(c.result)}));const t=new Image;t.src=e;const a=window.open(e);a==null||a.document.write(t.outerHTML)},f=r=>{if(!r)return r;const e=r.replace(/[^\d]/g,""),t=e.length;return t<=3?e:t<=7?`${e.slice(0,3)}-${e.slice(3)}`:`${e.slice(0,3)}-${e.slice(3,7)}-${e.slice(7,11)}`};return l.useEffect(()=>{u()},[]),s.jsxs("div",{children:[s.jsx(S,{title:"프로필 설정",icon:"back",onClick:()=>d(-1)}),s.jsx("section",{className:"flex flex-col gap-5 mt-5 py-3 px-4",children:s.jsx(O,{spinning:b,children:s.jsxs(i,{form:o,onFinish:v,className:"flex flex-col gap-2 relative",children:[s.jsx("div",{className:"flex justify-center",children:s.jsxs("div",{className:"mx-auto w-32 aspect-square relative",children:[s.jsx("img",{src:y||`${R}/${j}/${w}`,alt:"User-Profile",className:"w-full h-full object-cover rounded-full"}),s.jsx(i.Item,{name:"profilePic",rules:[{required:!0,message:"프로필 이미지를 입력해주세요"}],className:"absolute -bottom-7 -right-0",children:s.jsx(T,{name:"profilePic",showUploadList:!1,fileList:n,onChange:U,onPreview:$,beforeUpload:()=>!1,accept:"image/*",maxCount:1,children:s.jsx("div",{className:"flex bg-primary w-8 h-8 justify-center items-center rounded-full cursor-pointer border-2 border-white box-content",children:s.jsx(k,{className:"text-lg text-white"})})})})]})}),s.jsx("h3",{className:"text-slate-700 text-xs font-semibold pb-1",children:"닉네임"}),s.jsx(i.Item,{name:"name",rules:[{required:!0,message:"닉네임을 입력해주세요"},{}],children:s.jsx(x,{placeholder:"닉네임을 입력해주세요",size:"large",className:"h-12"})}),s.jsx("h3",{className:"text-slate-700 text-xs font-semibold pb-1",children:"전화번호"}),s.jsx(i.Item,{name:"tell",rules:[{required:!1,validator:async(r,e)=>e?/^01([0|1|6|7|8|9])-([0-9]{3,4})-([0-9]{4})$/.test(e)?Promise.resolve():Promise.reject("올바른 휴대폰 번호 형식이 아닙니다. (예: 010-1234-5678)"):Promise.resolve()}],children:s.jsx(x,{placeholder:"전화번호를 입력해주세요",size:"large",className:"h-12",maxLength:13,onChange:r=>{const e=r.target.value.replace(/[^\d]/g,""),t=f(e);o.setFieldsValue({tell:t})}})}),s.jsx("h3",{className:"text-slate-700 text-xs font-semibold pb-1",children:"생년월일"}),s.jsx(i.Item,{name:"birth",rules:[{required:!0,message:"생년월일을 입력해주세요"}],children:s.jsx(q,{placeholder:"생년월일을 입력해주세요",size:"large",className:"h-12 w-full"})}),s.jsx(i.Item,{children:s.jsx(z,{htmlType:"submit",type:"primary",size:"large",className:"h-12 w-full text-lg font-semibold",children:"완료"})})]})})})]})};export{de as default};
